<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <title>Leads Chain</title>
    <meta content="Admin Dashboard" name="description" />
    <meta content="Themesbrand" name="author" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <link rel="shortcut icon" href="../app/assets/images/tabicon.png">
    <link href="../app/assets/plugins/bootstrap-colorpicker/css/bootstrap-colorpicker.min.css" rel="stylesheet">
    <link href="../app/assets/plugins/bootstrap-datepicker/css/bootstrap-datepicker.min.css" rel="stylesheet">
    <link href="../app/assets/plugins/select2/css/select2.min.css" rel="stylesheet" type="text/css" />
    <link href="../app/assets/plugins/bootstrap-touchspin/css/jquery.bootstrap-touchspin.min.css" rel="stylesheet" />
    <link href="../app/assets/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="../app/assets/css/icons.css" rel="stylesheet" type="text/css" />
    <link href="../app/assets/css/style.css" rel="stylesheet" type="text/css" />
    <script src="./app.js"></script>
</head>

<body>
    <div id="preloader">
        <div id="status">
            <div class="spinner"></div>
        </div>
    </div>
    <header id="topnav">
        <div class="topbar-main">
            <div class="container">
                <div class="logo">
                    <a href="home.html" class="logo">
                        <img src="../app/assets/images/logo.png" alt="" height="30"> </a>
                </div>
                <div class="menu-extras topbar-custom">

                    <ul class="list-inline float-right mb-0">
                        <li class="list-inline-item dropdown notification-list hidden-xs-down">
                            <a class="nav-link waves-effect" href="#" id="btn-fullscreen">
                                <i class="mdi mdi-fullscreen noti-icon"></i>
                            </a>
                        </li>
                        <li class="list-inline-item dropdown notification-list">
                            <a class="dropdown-item btn btn-indigo waves-effect waves-light" id="logoutBtn" role="button">
                                <i class="dripicons-exit text-"></i> Logout </a>
                        </li>
                        <li class="menu-item list-inline-item">
                            <a class="navbar-toggle nav-link">
                                <div class="lines">
                                    <span></span>
                                    <span></span>
                                    <span></span>
                                </div>
                            </a>
                        </li>
                    </ul>
                </div>
                <div class="clearfix"></div>
            </div>
        </div>
        <div class="navbar-custom">
            <div class="container">
                <div id="navigation">
                    <ul class="navigation-menu">
                        <li class="has-submenu">
                            <a href="home.html">
                                <i class="mdi mdi-view-dashboard"></i>Home</a>
                        </li>
                        <li class="has-submenu">
                            <a href="subject.html">
                                <i class="mdi mdi-share-variant"></i>Create Certificate</a>
                        </li>
                        <li class="has-submenu">
                            <a href="create.html">
                                <i class="mdi mdi-buffer"></i>Issue Certificate</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </header>
    <div class="wrapper">
        <div class="container">
            <div class="row">
                <div class="col-sm-12">
                    <div class="page-title-box">
                        <h4 class="page-title">Corses/Subjects/Memberships</h4>
                    </div>
                    <div></div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-4">
                    <div class="card m-b-20">
                        <div class="card-block">
                            <form class="" id="regFormValidate">
                                <div class="form-group">
                                    <label for="insNameDrop">Institue Name</label>
                                    <select type="text" class="form-control" id="insNameDrop" name="insNameDrop" required data-parsley-required="true" data-parsley-required-message="Please Select a Institue Name.">
                                        <option value="">Please Select Institue</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="insTypeDrop">Type</label>
                                    <select type="text" class="form-control" id="insTypeDrop" name="insTypeDrop" required data-parsley-required="true" data-parsley-required-message="Please Select a Type.">
                                        <option value="">Please Select Type</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="name">Name</label>
                                    <input type="text" class="form-control" id="name" name="name" placeholder="Enter Corse/Subject/Membership Name" data-toggle="popover" data-trigger="focus" title="Corse/Subject/Membership Name" data-content="Please enter the Name of the Corse/Subject/Membership. The Corse/Subject/Membership Name must be more than 6 charecter long."
                                        required data-parsley-required-message="Please input Corse/Subject/Membership Name" data-parsley-minlength="6">
                                </div>
                                <div class="form-group">
                                    <label for="datepicker-autoclose">Completion Date</label>
                                    <input type="text" class="form-control" placeholder="Select Completion Date" id="datepicker-autoclose" required data-parsley-required-message="Please select Completion Date">
                                </div>
                                <div class="form-group">
                                    <label for="completionCriteria">Completion Criteria (Comma Seperated)</label>
                                    <input type="text" class="form-control" id="completionCriteria" name="completionCriteria" placeholder="Enter Completion Criteria (Comma Seperated)" data-toggle="popover" data-trigger="focus" title="Completion Criteria" data-content="Please enter the Completion Criteria of the Course. It shuld be just Keyword no descriptions , and must be more than 6 charecter long."
                                        required data-parsley-required-message="Please input Completion Criteria" data-parsley-minlength="6">
                                </div>
                                <div class="form-group" id="courseFDiv">
                                    <label for="coureFacilitator">Coure Facilitator</label>
                                    <input type="text" class="form-control" id="coureFacilitator" name="coureFacilitator" placeholder="Enter Coure Facilitator Name" data-toggle="popover" data-trigger="focus" title="Coure Facilitator" data-content="Please enter the Name of the Coure Facilitator."
                                        required data-parsley-required-message="Please input Coure Facilitator" data-parsley-minlength="6">
                                </div>
                                <div class="form-group">
                                    <div>
                                        <button type="submit" class="btn btn-outline-purple waves-effect waves-light" id="createButton"> Create </button>
                                        <button type="reset" class="btn btn-outline-danger waves-effect m-l-5"> Cancel </button>
                                    </div>
                                </div>
                                <div id="regModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" data-keyboard="false" data-backdrop="static" aria-hidden="true">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title mt-0" id="regModalLabel">LEADS
                                                    <i class="fa fa-chain"></i> Chain</h5>
                                                <button id="xButton" type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                                            </div>
                                            <div class="modal-body">
                                                <h2>Corses/Subjects/Memberships Created</h2>
                                                <p>Congratulation! you have successfully creatrd Corses/Subjects/Memberships. Now using our platform you can issue Digital Certificate.</p>
                                            </div>
                                            <div class="modal-footer">
                                                <button id="closeButton" type="button" class="btn btn-secondary waves-effect" data-dismiss="modal">Close</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div id="regModalError" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" data-keyboard="false" data-backdrop="static" aria-hidden="true">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title mt-0" id="">LEADS
                                                    <i class="fa fa-chain"></i> Chain</h5>
                                                <button id="xErrorButton" type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                                            </div>
                                            <div class="modal-body">
                                                <h2 class="text-danger">Something Went Wrong</h2>
                                                <p id="errorText" class="text-danger"></p>
                                            </div>
                                            <div class="modal-footer">
                                                <button id="closeErrorButton" type="button" class="btn btn-secondary waves-effect" data-dismiss="modal">Close</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="col-lg-8">
                    <div class="card m-b-20">
                        <div class="card-block" style="overflow: scroll; height: 610px">
                            <table id="institueTable" class="table table-bordered table-striped table-responsive">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Completion Date</th>
                                        <th>Completion Criteria</th>
                                    </tr>
                                </thead>
                                <tbody id="institueTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    2017 ©
                    <img src="../app/assets/images/logo.png" alt="" height="22">
                    <span class="text-muted hidden-xs-down pull-right">
                        Developed By
                        <i class="mbri-setting text-danger"></i> Digital Innovation
                    </span>
                </div>
            </div>
        </div>
    </footer>
    <script src="../app/assets/js/jquery.min.js"></script>
    <script src="../app/assets/js/tether.min.js"></script>
    <script src="../app/assets/js/bootstrap.min.js"></script>
    <script src="../app/assets/js/modernizr.min.js"></script>
    <script src="../app/assets/js/waves.js"></script>
    <script src="../app/assets/js/jquery.slimscroll.js"></script>
    <script src="../app/assets/js/jquery.nicescroll.js"></script>
    <script src="../app/assets/js/jquery.scrollTo.min.js"></script>
    <script type="text/javascript" src="../app/assets/plugins/parsleyjs/parsley.min.js"></script>
    <script src="../app/assets/plugins/bootstrap-colorpicker/js/bootstrap-colorpicker.min.js"></script>
    <script src="../app/assets/plugins/bootstrap-datepicker/js/bootstrap-datepicker.min.js"></script>
    <script src="../app/assets/plugins/select2/js/select2.min.js" type="text/javascript"></script>
    <script src="../app/assets/plugins/bootstrap-maxlength/bootstrap-maxlength.min.js" type="text/javascript"></script>
    <script src="../app/assets/plugins/bootstrap-filestyle/js/bootstrap-filestyle.min.js" type="text/javascript"></script>
    <script src="../app/assets/plugins/bootstrap-touchspin/js/jquery.bootstrap-touchspin.min.js" type="text/javascript"></script>
    <script src="../app/assets/pages/form-advanced.js"></script>
    <script src="../app/assets/js/jsPdf.min.js"></script>
    <script src="../app/assets/js/templateapp.js"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            if (sessionStorage.getItem('accessToken') === null) {
                window.location.href = "login.html";
            } else {
                $.ajax({
                    url: 'http://115.127.24.181:59311/api/Subjects',
                    method: 'GET',
                    headers: {
                        'Authorization': 'Bearer ' + sessionStorage.getItem('accessToken')
                    },
                    dataType: 'json',
                    success: function(response) {
                        $.each(response, function(i, value) {
                            var row = $('<tr><td>' + value.Name + '</td><td>' +
                                value.CompletionDate + '</td><td>' +
                                value.CompletionCriteria +
                                '</td></tr>'
                            );
                            $("#institueTableBody").append(row);
                        });
                    },
                    error: function(response) {
                        $("#regModalError").modal("show");
                        if (response.status === 401) {
                            var message = response.responseJSON.Message +
                                " Your log in session has expired! Please login again to access the documents."
                            $("#errorText").text(message);
                        } else {
                            $("#errorText").text(message);
                        }
                        $("#closeErrorButton").click(function() {
                            window.location.href = "login.html";
                        });
                        $("#xErrorButton").click(function() {
                            window.location.href = "login.html";
                        });
                    }
                });
                $.ajax({
                    url: 'http://115.127.24.181:59311/api/Institues',
                    method: 'GET',
                    headers: {
                        'Authorization': 'Bearer ' + sessionStorage.getItem('accessToken')
                    },
                    dataType: 'json',
                    success: function(response) {
                        $.each(response, function(i, value) {
                            var list = $('<option value="' + value.InstitueId + '">' +
                                value.InstitueName + '</option>')
                            $('#insNameDrop').append(list);
                        });
                    },
                    error: function(response) {
                        $("#regModalError").modal("show");
                        if (response.status === 401) {
                            var message = response.responseJSON.Message +
                                " Your log in session has expired! Please login again to access the documents."
                            $("#errorText").text(message);
                        } else {
                            $("#errorText").text(message);
                        }
                        $("#closeErrorButton").click(function() {
                            window.location.href = "login.html";
                        });
                        $("#xErrorButton").click(function() {
                            window.location.href = "login.html";
                        });
                    }
                });
                $.ajax({
                    url: 'http://115.127.24.181:59311/api/SelectTypes',
                    method: 'GET',
                    headers: {
                        'Authorization': 'Bearer ' + sessionStorage.getItem('accessToken')
                    },
                    dataType: 'json',
                    success: function(response) {
                        $.each(response, function(i, value) {
                            var list = $('<option value="' + value.SelectTypeId + '">' +
                                value.SelectTypeName + '</option>')
                            $('#insTypeDrop').append(list);
                        });
                    },
                    error: function(response) {
                        $("#regModalError").modal("show");
                        if (response.status === 401) {
                            var message = response.responseJSON.Message +
                                " Your log in session has expired! Please login again to access the documents."
                            $("#errorText").text(message);
                        } else {
                            $("#errorText").text(message);
                        }
                        $("#closeErrorButton").click(function() {
                            window.location.href = "login.html";
                        });
                        $("#xErrorButton").click(function() {
                            window.location.href = "login.html";
                        });
                    }
                });
                var insType = '';
                var insName = '';
                $("#courseFDiv").hide();
                $("#insNameDrop").change(function() {
                    insName = $("#insNameDrop").val();
                    console.log(insName);
                });
                $("#insTypeDrop").change(function() {
                    insType = $("#insTypeDrop").val();
                    console.log(insType);
                    if (insType == 2) {
                        $("#courseFDiv").show();
                    } else {
                        $("#courseFDiv").hide();
                        $("#coureFacilitator").removeAttr('required');
                    }
                });
                $("#createButton").click(function(e) {
                    var preventDefaults = e.preventDefault();
                    if (!$('form').parsley().validate()) return false;
                    $.ajax({
                        url: 'http://115.127.24.181:59311/api/Subjects/PostSubject',
                        method: 'POST',
                        headers: {
                            'Authorization': 'Bearer ' + sessionStorage.getItem('accessToken')
                        },
                        contentType: 'application/x-www-form-urlencoded',
                        data: {
                            Name: $("#name").val(),
                            CompletionDate: $("#datepicker-autoclose").val(),
                            TypeId: insType,
                            CoureFacilitator: $("#coureFacilitator").val(),
                            CompletionCriteria: $("#completionCriteria").val(),
                            InstitueId: insName
                        },
                        success: function() {
                            $("#regModal").modal("show");
                        },
                        error: function(response) {
                            $("#regModalError").modal("show");
                            console.log(response);
                            if (response.status === 400) {
                                displayModelStateErrors(response.responseJSON.ModelState);
                            }
                            if (response.status === 500) {
                                $("#errorText").text(response.responseJSON.Message);
                            }
                            if (response.status === 401) {
                                var message = response.responseJSON.Message +
                                    " Your log in session has expired! Please login again to access the documents."
                                $("#errorText").text(message);
                                $("#closeErrorButton").click(function() {
                                    window.location.href = "login.html";
                                });
                                $("#xErrorButton").click(function() {
                                    window.location.href = "login.html";
                                });
                            }
                        },
                        async: false
                    });
                    $("#closeButton").click(function() {
                        location.reload();
                    });
                    $("#xButton").click(function() {
                        location.reload();
                    });
                    $("#closeErrorButton").click(function() {
                        location.reload();
                    });
                    $("#xErrorButton").click(function() {
                        location.reload();
                    });
                });
                $("#logoutBtn").click(function() {
                    sessionStorage.removeItem('accessToken');
                    window.location.href = "login.html";
                });
            }
        });
    </script>
</body>

</html>